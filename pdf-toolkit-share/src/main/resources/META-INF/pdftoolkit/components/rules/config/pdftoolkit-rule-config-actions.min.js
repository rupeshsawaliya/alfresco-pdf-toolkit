if(typeof PDFToolkit=="undefined"||!PDFToolkit){var PDFToolkit={}}(function(){var d=YAHOO.util.Dom,c=YAHOO.util.Selector,b=YAHOO.util.Event;var a=Alfresco.util.encodeHTML,e=Alfresco.util.hasEventInterest;PDFToolkit.RuleConfigActionCustom=function(f){PDFToolkit.RuleConfigActionCustom.superclass.constructor.call(this,f);this.name="PDFToolkit.RuleConfigActionCustom";Alfresco.util.ComponentManager.reregister(this);this.customisations=YAHOO.lang.merge(this.customisations,PDFToolkit.RuleConfigActionCustom.superclass.customisations);this.renderers=YAHOO.lang.merge(this.renderers,PDFToolkit.RuleConfigActionCustom.superclass.renderers);return this};YAHOO.extend(PDFToolkit.RuleConfigActionCustom,Alfresco.RuleConfigAction,{customisations:{PDFAppend:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";this._getParamDef(h,"target-node")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";this._getParamDef(h,"target-node")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.append.target-node"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"target-node"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFSplitAtPage:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFSignature:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";this._getParamDef(h,"private-key")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";this._getParamDef(h,"private-key")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.signature.private-key"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"private-key"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFSplit:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFInsertAtPage:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";this._getParamDef(h,"insert-content")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";this._getParamDef(h,"insert-content")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.insert.target-node"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"insert-content"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFWatermark:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";this._getParamDef(h,"watermark-image")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";this._getParamDef(h,"watermark-image")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:select-file-dialog-button",displayLabel:this.msg("pdftoolkit.watermark.image"),_buttonLabel:this.msg("pdftoolkit.select-node"),_destinationParam:"watermark-image"},{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFEncryption:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}},PDFDeletePage:{text:function(h,g,f){this._getParamDef(h,"destination-folder")._type="path";return h},edit:function(h,g,f){this._getParamDef(h,"destination-folder")._type="hidden";h.parameterDefinitions.splice(0,0,{type:"pdftoolkit:destination-dialog-button",displayLabel:this.msg("pdftoolkit.destination-folder"),_buttonLabel:this.msg("pdftoolkit.select-folder"),_destinationParam:"destination-folder"});return h}}},renderers:{"pdftoolkit:select-file-dialog-button":{manual:{edit:true},currentCtx:{},edit:function(i,f,n,g,k){if(!this.widgets.selectedFileDialog){this.widgets.selectedFileDialog=new Alfresco.module.DocumentPicker(this.id+"-fileDialog");var j;if(this.options.siteId){j=Alfresco.constants.PROXY_URI+"slingshot/doclib/container/"+this.options.siteId+"/documentlibrary";Alfresco.util.Ajax.jsonGet({url:j,successCallback:{fn:function(o){var p=o.json.container.nodeRef;l.widgets.selectedFileDialog.setOptions({displayMode:"items",itemFamily:"node",itemType:"cm:content",multipleSelectMode:false,parentNodeRef:p,restrictParentNavigationToDocLib:false});l.widgets.selectedFileDialog.onComponentsLoaded()}}})}else{j=Alfresco.constants.PROXY_URI+"api/forms/picker/node/alfresco/company/home/children";Alfresco.util.Ajax.jsonGet({url:j,successCallback:{fn:function(o){var p="alfresco://company/home";l.widgets.selectedFileDialog.setOptions({displayMode:"items",itemFamily:"node",itemType:"cm:content",multipleSelectMode:false,parentNodeRef:p,restrictParentNavigationToDocLib:false});l.widgets.selectedFileDialog.onComponentsLoaded()}}})}}var l=this;this._createLabel(n.displayLabel,i);var m=g.parameterValues?g.parameterValues[n._destinationParam]:null;this._createPathSpan(i,f,n,this.id+"-"+f._id+"-fileLabel",m);this._createButton(i,f,n,g,function h(o,p){this.widgets.selectedFileDialog.singleSelectedItem=null;this.renderers["pdftoolkit:select-file-dialog-button"].currentCtx={configDef:p.configDef,ruleConfig:p.ruleConfig,paramDef:p.paramDef};YAHOO.Bubbling.on("onDocumentsSelected",function(r,s){if(s&&s[1].items){var t=s[1].items[0];if(t!=null){var q=this.renderers["pdftoolkit:select-file-dialog-button"].currentCtx;this._setHiddenParameter(q.configDef,q.ruleConfig,q.paramDef._destinationParam,t.nodeRef);Alfresco.util.ComponentManager.get(this.id+"-"+q.configDef._id+"-fileLabel").displayByPath(t.name,t.displayPath);this._updateSubmitElements(q.configDef)}}},this);this.widgets.selectedFileDialog.onShowPicker()})}},"pdftoolkit:destination-dialog-button":{manual:{edit:true},currentCtx:{},edit:function(l,k,f,i,j){this._createLabel(f.displayLabel,l);var g=i.parameterValues?i.parameterValues[f._destinationParam]:null;this._createPathSpan(l,k,f,this.id+"-"+k._id+"-destinationLabel",g);this._createButton(l,k,f,i,function h(n,p){this.renderers["pdftoolkit:destination-dialog-button"].currentCtx={configDef:p.configDef,ruleConfig:p.ruleConfig,paramDef:p.paramDef};if(!this.widgets.pdfDestinationDialog){this.widgets.pdfDestinationDialog=new Alfresco.module.DoclibGlobalFolder(this.id+"-destinationDialog");this.widgets.pdfDestinationDialog.setOptions({title:this.msg("dialog.destination.title")});YAHOO.Bubbling.on("folderSelected",function(s,r){if(e(this.widgets.pdfDestinationDialog,r)){var t=r[1].selectedFolder;if(t!==null){var q=this.renderers["pdftoolkit:destination-dialog-button"].currentCtx;this._setHiddenParameter(q.configDef,q.ruleConfig,q.paramDef._destinationParam,t.nodeRef);Alfresco.util.ComponentManager.get(this.id+"-"+q.configDef._id+"-destinationLabel").displayByPath(t.path,t.siteId,t.siteTitle);this._updateSubmitElements(q.configDef)}}},this)}var o=this._getParameters(p.configDef)["destination-folder"],m=[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE];if(this.options.repositoryBrowsing===true){m.push(Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME)}this.widgets.pdfDestinationDialog.setOptions({allowedViewModes:m,nodeRef:this.options.rootNode,pathNodeRef:o?new Alfresco.util.NodeRef(o):null});this.widgets.pdfDestinationDialog.showDialog()})}}}})})();